<!-- 2_howToWriteVerticallyToCanvas.html -->
<!DOCTYPE html />
<html>
  <head>
    <title>2_howToWriteVerticallyToCanvas.html</title>
    <style>
      canvas#vwrMain {
        border: 1px solid black;
      }
      div#main {
        margin: 5px;
      }
    </style>
    <script>
      function nameSpace(glb, spc) {
        var ns = spc.split(".");
        var spcs = glb;
        for (var i = 0; i < ns.length; i++) {
          spcs = spcs[ns[i]] = new Object();
        }
        return spcs;
      }

      (function (global, _$) {
        _$.textCanvas = function (canvasId) {
          this.Canvas = global.document.getElementById(canvasId);
          this.Canvas.width = 300;
          this.Canvas.height = 300;
          this.fontSize = 20;
          this.putCharVertically = function (val) {
            console.log(">>>> val", val);
            var _cxt = this.Canvas.getContext("2d");
            var hp = 0;
            var hps = 0;
            var vp = 0;
            var vps = 0;
            var chr = "";
            _cxt.clearRect(0, 0, 300, 300);
            _cxt.font = this.fontSize + "px Arial";
            for (var i = 0; i < val.length; i++) {
              chr = val.charAt(i);
              if (chr.match(/[、。]/)) {
                hp = 0;
              } else {
                hp = _cxt.measureText(chr).width;
              }
              vp = this.fontSize;
              _cxt.fillText(
                chr,
                260 - hps + this.fontSize - hp / 2,
                this.fontSize + vps
              );
              vps = vps + vp;
              if (vps > this.Canvas.height - this.fontSize * 2) {
                hps += this.fontSize;
                vps = 0;
              }
            }
          };
        };
      })(this, nameSpace(this, "aya.eiya.test"));
    </script>
  </head>

  <body
    onload="cvs = new aya.eiya.test.textCanvas('vwrMain');cvs.putCharVertically(document.getElementById('inMain').value);"
  >
    <h1>Canvas 添加竖排文字</h1>
    <div id="main">
      <canvas id="vwrMain"></canvas>
    </div>
    <form>
      <input
        type="text"
        id="inMain"
        onkeyup="cvs.putCharVertically(this.value);"
        value="HTML5测试中文的竖排功能是否可行，还在测试之中。"
      />
    </form>
  </body>
</html>
